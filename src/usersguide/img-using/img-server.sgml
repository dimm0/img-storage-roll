<section id="using-img-attr-server" xreflabel="using the img attr">
	<title>Using the Img-storage Roll attribute</title>

<para>
The Img-storage server is composed of the following component:
</para>



<orderedlist>

<listitem>
<para>
<emphasis>Rabbit MQ Server</emphasis> this component is used to orchestrate
all comunication between the various nodes and is installed on the frontend.
</para>
</listitem>

<listitem>
<para>
<emphasis>img-storage-vm</emphasis> this is the python daemon which is in charge
of managing the iSCSI mapping on the hosting machine (the machine that will run
the virtual machine). img-storage-vm is installed by default on all VM Container
appliances but it can be installed on other nodes simply by turning to true the
attribute <filename>img_storage_vm</filename>. You will also need KVM component
on the node to properly run virtual machine, so also the attribute <filename>
kvm</filename> should be set to true.
</para>
</listitem>

<listitem>
<para>
<emphasis>img-storage-nas</emphasis> this is the python daemon which is in manages
the virtual disk repository. It uses ZFS as the underlying technology for storage.
This daemon is also responsible to set up iSCSI targets for the img-storage-vm.
img-storage-vm is installed by default on all NASes appliance but it can be 
changed simply using the attribute <filename>img_storage_vm</filename> (the
attribute <filename>zfs</filename> should also be true in order to install zfs).
img-storage-nas allocates virtual disks on a zpool called tank, which
should be created manually by the administrator before any virtual machine
can be used.
</para>
</listitem>
</orderedlist>




<para>
For example to run virtual machine on a standard compute node it is necessary
to set:
</para>

<screen>
/opt/rocks/bin/rocks add appliance attr compute img_storage_vm true
/opt/rocks/bin/rocks add appliance attr compute kvm true
</screen>

<para>
Then reinstall all the compute nodes.
</para>

</section>

